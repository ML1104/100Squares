<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>100 Squares</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="js/fabric.js"></script>
</head>

<body>
    <div class="container">
        <canvas id="c" width="600" height="600"></canvas>
    </div>

    <script>
        var canvas = new fabric.Canvas('c');

        var firstMove = false;

        var rect = new fabric.Rect({
            fill: '#908CFF',
            width: 60,
            height: 60,
            selectable: false
        });

        var grid = 60;

        for (var i = 0; i < (600 / grid); i++) {
            canvas.add(new fabric.Line([i * grid, 0, i * grid, 600], { stroke: '#EEEEEE', selectable: false }));
            canvas.add(new fabric.Line([0, i * grid, 600, i * grid], { stroke: '#EEEEEE', selectable: false }));
        }

        canvas.on('object:added', function (options) {
            options.target.set({
                left: Math.round(options.target.left / grid) * grid,
                top: Math.round(options.target.top / grid) * grid
            });
        });

        canvas.on('mouse:down', function () {
            getMouseCoord();
        });

        function getMouseCoord(event) {
            var pointer = canvas.getPointer(event);
            var posX = pointer.x;
            var posY = pointer.y;
            console.log(posX + ", " + posY);

            if (firstMove === false) {
                rect.top = pointer.y - 30;
                rect.left = pointer.x - 30;

                canvas.add(rect);
                firstMove = true;
            }

            else {
                return;
            }
        }

        var linear1 = new fabric.Rect({
            width: 60,
            height: 60,
            fill: '#C3BAFF',
            selectable: false,
            left: rect.left - 180,
            top: rect.top
        })

        var linear2 = new fabric.Rect({
            width: 60,
            height: 60,
            fill: '#C3BAFF',
            selectable: false,
            left: rect.left + 180,
            top: rect.top
        })

        var linear3 = new fabric.Rect({
            width: 60,
            height: 60,
            fill: '#C3BAFF',
            selectable: false,
            top: rect.top + 180,
            left: rect.left
        })

        var linear4 = new fabric.Rect({
            width: 60,
            height: 60,
            fill: '#C3BAFF',
            selectable: false,
            top: rect.top - 180,
            left: rect.left
        })

        var nonLinear1 = new fabric.Rect({
            width: 60,
            height: 60,
            fill: '#C3BAFF',
            selectable: false
        })

        var nonLinear2 = new fabric.Rect({
            width: 60,
            height: 60,
            fill: '#C3BAFF',
            selectable: false
        })

        var nonLinear3 = new fabric.Rect({
            width: 60,
            height: 60,
            fill: '#C3BAFF',
            selectable: false
        })

        var nonLinear4 = new fabric.Rect({
            width: 60,
            height: 60,
            fill: '#C3BAFF',
            selectable: false
        })

        var linearSquares = new fabric.Group([ linear1, linear2, linear3, linear4 ]);
        var nonLinearSquares = new fabric.Group([ nonLinear1, nonLinear2, nonLinear3, nonLinear4 ]);

        console.log(linearSquares);

        rect.on('mousedown', function() {
            canvas.add(linearSquares);
        });

        canvas.renderAll();
    </script>
</body>

</html>